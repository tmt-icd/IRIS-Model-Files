subsystem = IRIS
component = imager.shutter

publish {
  events = [
    {
      name = state
      description = "Standard assembly state as defiend in [Technical Document: Software Design Patterns for Device and Component Controllers (TMT.INS.TEC.16.079)](https://docushare.tmt.org/docushare/dsweb/Services/Document-57492) plus alpha."
      maxRate = 1
      archive = true
      attributes = [
        {
            name = cmd
            description  = "command state"
            enum = [UNINITIALIZED, READY, BUSY, COTINUOUS]
        }
        {
            name = move
            description  = "state of mechanisms that can move"
            enum = [TRUE, FALSE]
        }
        {
            name = selection
            description  = """
This state attribute indicates where the shutter is. The meaning of each enum value is as follows:

<ul>
 <li><b>OPEN</b>:         The shutter is in the open position.</li>
 <li><b>CLOSED</b>:       The shutter is closed.</li>
 <li><b>UNKNOWN</b>:      This assembly falls into this state before datuming is completed or when an error is detected.</li>
 <li><b>INTERMEDIATE</b>: This assembly falls into this state, which indicates that the shutter is somewhere between the open and closed positions.</li>
</ul>
"""
            enum = [OPEN, CLOSED, UNKNOWN, INTERMEDIATE]
        }
        {
            name = debug
            description  = "debug level"
            enum = [DEBUG, INFO, WARN, ERROR]
        }
        {
            name = enabled
            description = "indicates whether this assembly is enabled"
            type = boolean
        }
        {
            name = inhibit
            description = "indicates if the inhibit signal to the underlying motion controller is active"
            type = boolean
        }
        {
            name = motion
            enum = [TBD, ERROR]
            description  = """
(TODO: fill out)
"""
        }
        {
            name = errorMsg
            description = "detailed error message when it is in ERROR state"
            type = string
        }
      ]
    }
    {
      name = cmdStatus
      description = "Standard assembly command status as defiend in [Technical Document: Software Design Patterns for Device and Component Controllers (TMT.INS.TEC.16.079)](https://docushare.tmt.org/docushare/dsweb/Services/Document-57492)."
      maxRate = 1
      archive = true
      attributes = [
        {
            name = command
            description  = "Name of the most recent command."
            type = string
        }
        {
            name = args
            description  = "String representation of the command arguments."
            type = string
        }
        {
            name = caller
            description  = "String identifying the caller (if available)"
            type = string
        }
        {
            name = runID
            description  = "A run ID associated with the command."
            type = integer
        }
        {
            name = ack
            description  = "Initial acknowledgement"
            enum = [ACCEPTED, REJECTED]
        }
        {
            name = ackMsg
            description  = "Acknowledgement string explaining why a command is REJECTED. This string will generally be cleared if the command is ACCEPTED."
            type = string
        }
        {
            name = completion
            description  = "Status of completion"
            enum = [INPROGRESS, SUCCESS, FAILED, INTERRUPTED, REJECTED]
        }
        {
            name = completionMsg
            description  = "The message string is cleared when a command has been successfully acknowledged and/or is INPROGRESS. The message string is filled in if the command fails."
            type = string
        }
      ]
    }
    {
      name = mechanism
      description = "Current status of the shutter mechanism."
      maxRate = 10
      archive = false
      attributes = [
        {
            name  = rawPosition
            description = """
The current raw position reported by the HCD.

This value does not represent the absolute position of the shutter. This value will be published only for engineering purposes.
"""
            type  = double
            units = steps
        }
        {
            name  = rawVelocity
            description = """
The current velocity reported by the HCD.

This value does not represent the velocity of the shutter, but the rotation velocity of the stepper motor.

This value will be published only for engineering purposes.
"""
            type  = double
            units = step/s
        }
        {
            name  = rawAcceleration
            description = """
The current acceleration reported by the HCD.

This value does not represent the acceleration of the shutter, but the rotation acceleration of the stepper motor.

This value will be published only for engineering purposes.
"""
            type  = double
            units = step/s<sup>2</sup>
        }
        {
            name  = position
            description = """
(TODO: fill out)

It becomes NaN when undatumed or datuming.

This value will be published only for engineering purposes.
"""
            type     = double
            units    = deg
            minimum  = 0
            allowNaN = true
        }
        {
            name  = velocity
            description = """
Current commanded velocity of the stage.

This value becomes positive if the shutter is moving in the direction of the open position.

This value will be published only for engineering purposes.
"""
            type  = double
            units = deg/s
        }
        {
            name  = acceleration
            description = """
Current commanded acceleration of the stage.

This value becomes positive if the stage is accelerating towards the open position.

This value will be published only for engineering purposes.
"""
            type  = double
            units = deg/s<sup>2</sup>
        }
        {
            name  = power
            description = "indicates if the stepper motor is powered or not."
            type  = boolean
        }
        {
            name = switches
            description  = "(TODO: fill out)"
            type        = struct
            attributes = [
              {
                name = "TBD1"
                description = "(TODO: fill out)"
                type = boolean
              }
              {
                name = "TBD2"
                description = "(TODO: fill out)"
                type = boolean
              }
              {
                name = "TBD3"
                description = "(TODO: fill out)"
                type = boolean
              }
              {
                name = "TBD4"
                description = "(TODO: fill out)"
                type = boolean
              }
            ]
        }
      ]
    }
  ]

  alarms = [
    {
      name             = watchdog
      description      = "This assembly has become unresponsive"
      severityLevels   = [Major]
      location         = "IRIS Imager Shutter Assembly (IRIS.imager.shutter)"
      alarmType        = System
      probableCause    = "Software bug"
      operatorResponse = "Restart the assembly and file a bug report."
      autoAck          = false
      latched          = true
    }
    {
      name             = incompatibleStageConfiguration
      description      = "The stage configuration in the Newport XPS motion controller is not compatible with this assembly."
      severityLevels   = [Critical]
      location         = "IRIS Imager Shutter Assembly (IRIS.imager.shutter)"
      alarmType        = System
      probableCause    = "Misconfiguration"
      operatorResponse = "Reconfigure the stage configuration in the Newport XPS motion controller and reboot it."
      autoAck          = false
      latched          = false
    }
    {
      name             = inconsistentSensorStatus
      description      = "hall sensor electronics outputs are inconsistent"
      severityLevels   = [Critical]
      location         = "IRIS Imager Shutter Assembly (IRIS.imager.shutter)"
      alarmType        = BitPattern
      probableCause    = "Cable disconnection or malfunction of hall sensors and/or their reading electronics"
      operatorResponse = "Make sure that all relevant cables are connected to the hall sensor reading electronics and the Newport XPS motion controller properly. Then, reboot this assembly."
      autoAck          = false
      latched          = true
    }
  ]
}
