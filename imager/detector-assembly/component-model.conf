subsystem = IRIS
component = imager-detector-assembly
modelVersion = "1.0"

wbsId = tmt.ins.inst.iris.imager.sw

title = "IRIS Imager Detector Assembly"
prefix = iris.imager.detector
componentType = Assembly

description = """
There are four 4k x 4k detectors aligned in a tile-like fashion in the Imager. This assembly is responsible for configuring and executing exposures of those detectors via the SIDECAR or ARC HCD. This assembly also tracks and reports the status of the on-going exposures.

On-chip guiding or ODGW (On-Detector Guide Window) is coordinated by odgw-assembly separately.

This assembly will NOT perform any data reduction or sampling arithmetic, which will be done by a separate process in DRS. Instead, readouts are continuously taken during a ramp and all readouts are saved to readout disk (DSK-DRS). Instead of this assembly, underlying HCDs (Sidecar or ARC HCDs) will save the readouts to the disk so that this assembly does not have to unnecessarily communicate with the HCDs to continuously obtain readouts. This assembly sends an event when a new readout is saved to the disk so that DRS will be able to start processing immediately. More details about the scheme for passing readout data to DSK-DRS are described in [ICD IMG-DRS](https://docushare.tmt.org/docushare/dsweb/ServicesLib/Document-51744/History).

The diagram below shows the naming convention of 4 detectors. Top left detector is #1, top right one is #2, bottom left one is #3 and bottom right one is #4 looking toward the direction of science beam. Some configurations are defined per detector as an array of 4 elements, and the first element (index is 0) corresponds to #1.

![Naming conventoin and coordinate of detectors](https://raw.githubusercontent.com/chrisaj5/IRIS-Model-Files/master/imager/detector-assembly/naming_convention_and_coordinate_of_detector.png)

This assembly provides only one functional group, which means this assembly is capable of executing one command at a time. When taking an exposure, those detectors will be considered as one detector; which means one exposure command to this assembly takes exposures of those four detectors at the same time.

Note that the focus stage will NOT be controlled by this assembly. As described in [IRIS Imager Design Note: Detector Assembly (TMT.INS.TEC.16.080.DRF01)](https://docushare.tmt.org/docushare/dsweb/Get/Document-57495/DN%20IRIS.IMG.DET_DRF01.docx), the focus stage will be used in the optical alignment process, and will not be used in commissioning or observation. The focus stage would be even mechanically locked somehow (TBC), and probably no motion controller will be connected to the motor for the focus stage so that software will not accidentally move the detector stage.

The list below shows TODO to finalize the software design in detail:

* It is not currently sure if the independent control of each detector is required. If required, it is probably better for this assembly to have one functional group for one detector so that the independent control of each detector will be naturally possible while the coordination among four detectors will be made at another part. Currently, the model files of this assembly do not allow independent control of each detector.
* Currently, the model files of this assembly do not allow subraster reading. If the sub-region size of one detector is different from another, the readout time will be also different. It possibly leads to different integration time for each detector, which may not be desirable for some science cases, so some synchronization is required.
* Revise the state variables in accordance with [Software Design Patterns for Device and Component Controllers (TMT.INS.TEC.16.079.DRF01)](https://docushare.tmt.org/docushare/dsweb/Get/Document-57492/cc_design_patterns_DRF01_b.docx) and draw state transition diagram if necessary.
"""
