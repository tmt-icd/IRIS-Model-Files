subsystem = IRIS
component = pupilview-assembly

description = """
Commands which can be accepted by IRIS Pupil Viewing Assembly.

This command model is designed based on [Software Design Patterns for Device and Component Controllers (TMT.INS.TEC.16.079.DRF01)](https://docushare.tmt.org/docushare/dsweb/Get/Document-57492/cc_design_patterns_DRF01_b.docx). As proposed by the design pattern, standard assembly commands and assembly-specific commands are provided for each functional group. All commands are classified into either 'request' or 'submit' based on the command type defintion described in the design pattern document.
"""

receive = [
    {
        name = DETECTOR_INIT
        description = """This command reloads configuration of the detector. This command can be invoked only when there is no on-going exposure.

Command type: request
"""
    }
    {
        name = MIRROR_INIT
        description = """This command reloads configuration of the fold mirror stage. This command can be invoked only when the fold mirror stage is not moving.

Command type: request
"""
    }
    {
        name = DETECTOR_TEST
        description = """This command executes a self-test of the detector

__TBD__: Actual action to be taken is TBD.

Command type: request
"""
    }
    {
        name = MIRROR_TEST
        description = """This command executes a self-test of the fold mirror stage.

This command never moves the fold mirror stage.

__TBD__: Actual action to be taken is TBD.

Command type: request
"""
    }
    {
        name = DETECTOR_DATUM
        description = """
This command turns on power of the pupil viewing detector if they are not on, then applies the system configuration (e.g. gain, number of channels) to the detector controllers. Timing code may be downloaded to DSP in the detector controller if necessary. This command can be invoked only when there is no on-going motion.

Command type: request
"""
    }
    {
        name = MIRROR_DATUM
        description = """
This command triggers datuming of the fold mirror stage. It first performs homing of the fold mirror stage. After the homing is completed, the stage moves to the specifiedd initial position (HOME, IN or OUT).

Command type: submit
"""
        args = [
            {
                name = initialPosition
                description = "initial position after homing"
                enum = [HOME, IN, OUT]
                default = HOME
            }
        ]
    }
    {
        name = DETECTOR_LOCK
        description = """
This command locks the detector so that it won't start clocking, or exposure until DETECTOR_UNLOCK command is executed. This command will be used in Warm Stow use case as mentioned in [IRIS Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx).

__TBD__: Acutal action to be taken is TBD.

Command type: submit
"""
    }
    {
        name = MIRROR_LOCK
        description = """
This command locks the retraction axis. This command is used in 'Warm Stow' and 'Stow' use cases defined in [IRIS - Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx) before pumping or warming the dewer.

__TBD__: Actual action to be taken is TBD. This assembly would move the fold mirror stage to the dedicated position and enable mechanical lock to ensure that it won't be moved.

Command type: submit
"""
    }
    {
        name = DETECTOR_UNLOCK
        description = """
This command unlocks the detector so that it can start an exposure. This command will be used in Activate and Warm Activate use cases as mentioned in [IRIS Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx).

__TBD__: Actual action to be taken is TBD. This may do nothing.

Command type: submit
"""
    }
    {
        name = MIRROR_UNLOCK
        description = """
This command unlocks the fold mirror stage. This command will be used in Activate and Warm Activate use cases as mentioned in [IRIS Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx).

__TBD__: Actual action to be taken is TBD. This may do nothing.

Command type: submit
"""
    }
    {
        name = DETECTOR_START_EXPOSURE
        description = """
This command starts a new exposure with the given cofinguration.

__TODO__: Define arguments.

Command type: submit
"""
    }
    {
        name = DETECTOR_ABORT_EXPOSURE
        description = """
This command aborts the current exposure.

Command type: submit
"""
    }
    {
        name = MIRROR_MOVE
        description = """
This command inserts or retracts the fold mirror into/from the science light path.

Command type: submit
"""
        requiredArgs = [position]
        args = [
            {
                name = position
                description = "Desired position of the fold mirror."
                enum = [IN, OUT]
            }
        ]
    }
    {
        name = DETECTOR_PARK
        description = """
This command cancels all on-going exposures and turns off power of the detector.

Command type: submit
"""
    }
    {
        name = MIRROR_PARK
        description = """
This command is supposed to be called at the end of each night.

__TBD__: Actual action to be taken is TBD.

Command type: submit
"""
    }
    {
        name = MIRROR_STOP
        description = """
This command stops any on-going command execution or motion of the fold mirror stage.

Command type: submit
"""
    }
]
