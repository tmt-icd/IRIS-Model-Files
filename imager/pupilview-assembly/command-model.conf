subsystem = IRIS
component = pupilview-assembly

description = """
Commands which can be accepted by IRIS Pupil Viewing Assembly.
This command model is based on the recommendation in "Software Design Patterns for Device and Component Controllers" which defines the standard sets of commands, and the command types (request or submit). The commands for component lifecycle defined in [OSW TN013 - Component Lifecycle Design and Implementation (TMT.SFT.TEC.15.006.REL04)](https://docushare.tmt.org/docushare/dsweb/Get/Document-46346/OSW%20TN013-ComponentLifecycleDesign_REL04.pdf) is classified as "lifecycle".
"""

receive = [
    {
        name = INITIALIZE
        description = """
This command loads the configuration of this assembly from Configuration Service or a local file ( __TBD__ ). It is accepted only when this assembly is in Loaded state. After successful completion of this command execution, this assembly will be staged in Initialized state. If it fails, this assembly will stay in Loaded state.

This command never rotates any axis, take an exposure, nor does it trigger the communication with underlying HCDs.

__TBD__: identify what configuration to be loaded

Command type: lifecycle
"""
    }
    {
        name = UNINITIALIZE
        description = """
This command stages this assembly in Loaded state from Initialized so that the initialization can be performed again after the configuration is changed. It does nothing other than that. If it fails, this assembly will stay in Initialized state.

This command never rotates any axis, take exposure, power on the detector, nor does it trigger the communication with underlying HCDs.

Command type: lifecycle
"""
    }
    {
        name = STARTUP
        description = """
This command establishes connection to relevant all underlying HCDs, and turns on the motion controller if it is off. It is accepted only when this assembly is in Initialized state. After successful completion of this command execution, this assembly will be staged in Running state. If it fails, this assembly will stay in Initialized state.

This command never rotates any axis, take an exposure, nor does it power on the detector, but it excites the motors to hold the current positions of all axes, so it may affect the thermal condition inside the dewar. If any motion is on-going, it is interrupted and stopped.

Command type: lifecycle
"""
    }
    {
        name = SHUTDOWN
        description = """
This command cancels the on-going movement and stage this assembly in Initialized after the command execution succeeds. This command can be called when the fold mirror stage is not moving and there is no on-going exposure.

Before going to Initialized state, stop command to the fold mirror stage and abort command to the detector are issued to make sure that everything is stopped. After that, connection to underlying HCDs will be released so that the connection can be reestablished (TBC).

Command type: lifecycle
"""
    }
    {
        name = DETECTOR_INIT
        description = """This command reloads configuration of the detector. This command can be invoked only when there is no on-going exposure.

Command type: request
"""
    }
    {
        name = MIRROR_INIT
        description = """This command reloads configuration of the fold mirror stage. This command can be invoked only when the fold mirror stage is not moving.

Command type: request
"""
    }
    {
        name = DETECTOR_TEST
        description = """This command executes a self-test of the detector

__TBD__: Actual actions to be taken is TBD.

Command type: request
"""
    }
    {
        name = MIRROR_TEST
        description = """This command executes a self-test of the fold mirror stage.

This command never moves the fold mirror stage.

__TBD__: Actual actions to be taken is TBD.

Command type: request
"""
    }
    {
        name = MIRROR_DATUM
        description = """
This command triggers datuming of the fold mirror stage. It first performs homing of the fold mirror stage. After the homing is completed, the stage moves to the specifiedd initial position (HOME, IN or OUT).

Command type: submit
"""
        args = [
            {
                name = initialPosition
                description = "initial position after homing"
                enum = [HOME, IN, OUT]
                default = HOME
            }
        ]
    }
    {
        name = DETECTOR_LOCK
        description = """
This command locks the detector so that it won't start clocking, or exposure until DETECTOR_UNLOCK command is executed. This command will be used in Warm Stow use case as mentioned in [IRIS Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx).

__TBD__: Acutal action to be taken is TBD.

Command type: submit
"""
    }
    {
        name = MIRROR_LOCK
        description = """
This command locks the retraction axis. This command is used in 'Warm Stow' and 'Stow' use cases defined in [IRIS - Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx) before pumping or warming the dewer.

__TBD__: Actual actions to be taken is TBD. This assembly would move the fold mirror stage to the dedicated position and enable mechanical lock to ensure that it won't be moved.

Command type: submit
"""
    }
    {
        name = DETECTOR_UNLOCK
        description = """
This command unlocks the detector so that it can start an exposure. This command will be used in Activate and Warm Activate use cases as mentioned in [IRIS Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx).

__TBD__: Actual actions to be taken is TBD. This may do nothing.

Command type: submit
"""
    }
    {
        name = MIRROR_UNLOCK
        description = """
This command unlocks the fold mirror stage. This command will be used in Activate and Warm Activate use cases as mentioned in [IRIS Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx).

__TBD__: Actual actions to be taken is TBD. This may do nothing.

Command type: submit
"""
    }
    {
        name = DETECTOR_START_EXPOSURE
        description = """
This command starts a new exposure with the given cofinguration.

__TODO__: Define arguments.

Command type: submit
"""
    }
    {
        name = DETECTOR_ABORT_EXPOSURE
        description = """
This command aborts the current exposure.

Command type: submit
"""
    }
    {
        name = DETECTOR_POWER_ON
        description = """This command turns on power of the pupil viewing detector. This command will be used in Activate and Warm Activate use cases as mentioned in [IRIS Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx).

Command type: request
"""
    }
    {
        name = DETECTOR_POWER_OFF
        description = """This command turns off power of the pupil viewing detector. This command will be used in Stow and Warm Stow use cases as mentioned in [IRIS Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx).

Command type: request
"""
    }
    {
        name = MIRROR_MOVE
        description = """
This command inserts or retracts the fold mirror into/from the science light path.

Command type: submit
"""
        requiredArgs = [position]
        args = [
            {
                name = position
                description = "Desired position of the fold mirror."
                enum = [IN, OUT]
            }
        ]
    }
    {
        name = MIRROR_PARK
        description = """
This command is supposed to be called at the end of each night.

__TBD__: Actual actions to be taken is TBD.

Command type: submit
"""
    }
    {
        name = MIRROR_STOP
        description = """
This command stops any on-going command execution or motion of the fold mirror stage.

Command type: submit
"""
    }
]
