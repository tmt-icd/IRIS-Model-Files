subsystem = IRIS
component = imager.coldstop

publish {
  events = [
    {
      name = RETRACT-state
      ref  = imager.adc/events/RETRACT-state
    }
    {
      name = RETRACT-cmdStatus
      ref  = imager.shutter/events/cmdStatus
    }
    {
      name = RETRACT-stage
      ref  = imager.adc/events/RETRACT-stage
    }
    
    {
      name = MASK-rotaryStage
      description = "Current status of the cold stop rotary stage."
      ref  = imager.adc/events/PRISM-p1
    }
    {
      name = MASK-rotaryStageMotion
      description = "Motion status of the cold stop rotary stage."
      ref  = imager.adc/events/PRISM-p1Motion
    }
    {
      name = MASK-xStage
      description = "Current status of the cold stop precise X linear stage."
      ref  = imager.adc/events/PRISM-p1
    }
    {
      name = MASK-xStageMotion
      description = "Motion status of the cold stop precise X linear stagee."
      archive = false
      attributes = [
        {
            name = onTarget
            description  = "whether the stage is on the target position or not"
            type = boolean
        }
        {
            name  = rawPosition
            description = """
The raw position reported by the HCD.

This value does not always represent the absolute position of the stage. This can be a meaningless value when datuming. This value will be published only for engineering purposes.
"""
            type  = double
            units = steps
        }
        {
            name  = rawPositionError
            description = "The raw position error reported by the HCD. This value will be published only for engineering purposes."
            type  = double
            units = steps
        }
        {
            name  = position
            description = """
The estimated position of the stage from the datum (the positive direction is TBD).

It becomes NaN when undatumed or datuming.

This value will be published only for engineering purposes.
"""
            type     = double
            units    = mm
            allowNaN = true
            exclusiveMinimum = -Inf
            exclusiveMaximum = Inf
        }
        {
            name  = positionError
            description = """
The estimated position error of the stage.

It becomes NaN when undatumed or datuming.

This value will be published only for engineering purposes.
"""
            type     = double
            units    = mm
            allowNaN = true
            exclusiveMinimum = -Inf
            exclusiveMaximum = Inf
        }
        {
            name  = velocity
            description = """
Velocity of the stage. The positive direction is TBD.

This value will be published only for engineering purposes.
"""
            type  = double
            units = mm/s
            exclusiveMinimum = -Inf
            exclusiveMaximum = Inf
        }
        {
            name  = acceleration
            description = """
Acceleration of the stage. The positive direction is TBD.

This value will be published only for engineering purposes.
"""
            type  = double
            units = mm/s<sup>2</sup>
            exclusiveMinimum = -Inf
            exclusiveMaximum = Inf
        }
        {
            name  = targetPosition
            description = """
The target position of the current motion if a motion is ongoing, or that of the previous motion if a motion is not ongoing. The definition of the angle is the same as the "position" attribute.

It becomes NaN when initialized.

This value will be published only for engineering purposes.
"""
            type     = double
            units    = mm
            allowNaN = true
            exclusiveMinimum = -Inf
            exclusiveMaximum = Inf
        }
        {
          name          = timestamp
          description   = "The best guess of the time when the position was sampled (units and epoch are TBD)"
          units         = mjd
          type          = long
        }
        {
          name          = timestampLowerBoundary
          description   = "Lower boundary of the confidence interval of the timestamp. The definition of the confident level is TBD."
          units         = second
          maximum       = 0
          type          = double
        }
        {
          name          = timestampUpperBoundary
          description   = "Upper boundary of the confidence interval of the timestamp. The definition of the confident level is TBD."
          units         = second
          minimum       = 0
          type          = double
        }
      ]
    }
    {
      name = MASK-yStage
      description = "Current status of the cold stop precise Y linear stage."
      ref  = imager.adc/events/PRISM-p1
    }
    {
      name = MASK-yStageMotion
      description = "Motion status of the cold stop precise Y linear stagee."
      ref  = imager.coldstop/events/MASK-yStageMotion
    }
  ]

  alarms = [
    {
      name             = MASK-watchdog
      description      = "The MASK functional group is unresponsive."
      severityLevels   = [Major]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = System
      probableCause    = "Software bug"
      operatorResponse = "Restart the assembly and file a bug report."
      autoAck          = false
      latched          = true
    }
    {
      name             = MASK-incompatibleStageConfiguration
      description      = "The stage configuration for the rotary stage and/or precise XY stages in the Newport XPS motion controller is not compatible with this functional group."
      severityLevels   = [Warning, Major, Critical]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = System
      probableCause    = "Misconfiguration"
      operatorResponse = "Reconfigure the stage configuration in the Newport XPS motion controller and reboot it."
      autoAck          = false
      latched          = false
    }
    {
      name             = MASK-missingPupilRotationTarget
      description      = "Haven't received the target pupil rotation angle from TCS for a long time. For that, the S/N ratio of the ongoing exposure may be worse than usual."
      severityLevels   = [Warning, Major]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = System
      probableCause    = "Network connection with TCS is lost."
      operatorResponse = "Judge if the current observation should continue or be interrupted. Check the status of TCS and the network connection."
      autoAck          = false
      latched          = true
    }
    {
      name             = MASK-rotaryStageInconsistentSensorStatus
      description      = "Sensor status of the rotary stage is inconsistent."
      severityLevels   = [Warning, Critical]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = BitPattern
      probableCause    = "Cable disconnection, or malfunction of the hall sensor or the hall sensor readout electronics."
      operatorResponse = "Make sure that all relevant cables are connected to the Newport XPS motion controller properly and reboot this Assembly."
      autoAck          = false
      latched          = true
    }
    {
      name             = MASK-xStageInconsistentSensorStatus
      description      = "Sensor status of the precise X linear stage is inconsistent."
      severityLevels   = [Warning, Critical]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = BitPattern
      probableCause    = "Cable disconnection, or malfunction of the hall sensor or the hall sensor readout electronics."
      operatorResponse = "Make sure that all relevant cables are connected to the Newport XPS motion controller properly and reboot this Assembly."
      autoAck          = false
      latched          = true
    }
    {
      name             = MASK-yStageInconsistentSensorStatus
      description      = "Sensor status of the precise Y linear stage is inconsistent."
      severityLevels   = [Warning, Critical]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = BitPattern
      probableCause    = "Cable disconnection, or malfunction of the hall sensor or the hall sensor readout electronics."
      operatorResponse = "Make sure that all relevant cables are connected to the Newport XPS motion controller properly and reboot this Assembly."
      autoAck          = false
      latched          = true
    }

    {
      name             = RETRACT-watchdog
      description      = "The RETRACT functional group is unresponsive"
      severityLevels   = [Major]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = System
      probableCause    = "Software bug"
      operatorResponse = "Restart the assembly and file a bug report."
      autoAck          = false
      latched          = true
    }
    {
      name             = RETRACT-incompatibleStageConfiguration
      description      = "The stage configuration for the retract stage in the Newport XPS motion controller is not compatible with this functional group."
      severityLevels   = [Warning, Major, Critical]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = System
      probableCause    = "Misconfiguration"
      operatorResponse = "Reconfigure the stage configuration in the Newport XPS motion controller and reboot it."
      autoAck          = false
      latched          = false
    }
    {
      name             = RETRACT-inconsistentSensorStatus
      description      = "Sensor status of the retract stage is inconsistent."
      severityLevels   = [Critical]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = BitPattern
      probableCause    = "Cable disconnection, or malfunction of sensors or the hall sensor readout electronics."
      operatorResponse = "Make sure that all relevant cables are connected to the Newport XPS motion controller properly and reboot this Assembly."
      autoAck          = false
      latched          = true
    }
    {
      name             = RETRACT-stepout
      description      = "Stepout of the stepper motor is detected in the retract stage"
      severityLevels   = [Warning, Major, Critical]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = Discrepancy
      probableCause    = "Wear-out of the retract stage mechanism."
      operatorResponse = "Report the issue to the instrument expert."
      autoAck          = false
      latched          = true
    }
    {
      name             = RETRACT-overheat
      description      = "Overheating detected"
      severityLevels   = [Major]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = Absolute
      probableCause    = "The cold stop mask was retracted/deployed too many times in a short period."
      operatorResponse = "Monitor the temperature and wait until it is cooled."
      autoAck          = false
      latched          = true
    }
  ]
}