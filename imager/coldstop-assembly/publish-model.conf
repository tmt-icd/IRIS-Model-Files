subsystem = IRIS
component = imager.coldstop

publish {
  events = [
    {
      name = RETRACT-state
      ref  = imager.adc/events/RETRACT-state
    }
    {
      name = RETRACT-cmdStatus
      ref  = imager.shutter/events/cmdStatus
    }
    {
      name = RETRACT-stage
      ref  = imager.adc/events/RETRACT-stage
    }
    
    {
      name = MASK-rotaryStage
      ref  = imager.adc/events/PRISM-p1
    }
    {
      name = MASK-rotaryStageMotion
      ref  = imager.adc/events/PRISM-p1Motion
    }
  ]

  alarms = [
    {
      name             = MASK-watchdog
      description      = "The MASK functional group is unresponsive."
      severityLevels   = [Major]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = System
      probableCause    = "Software bug"
      operatorResponse = "Restart the assembly and file a bug report."
      autoAck          = false
      latched          = true
    }
    {
      name             = MASK-incompatibleStageConfiguration
      description      = "The stage configuration for the rotary stage and/or precise XY stages in the Newport XPS motion controller is not compatible with this functional group."
      severityLevels   = [Warning, Major, Critical]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = System
      probableCause    = "Misconfiguration"
      operatorResponse = "Reconfigure the stage configuration in the Newport XPS motion controller and reboot it."
      autoAck          = false
      latched          = false
    }
    {
      name             = MASK-missingPupilRotationTarget
      description      = "Haven't received the target pupil rotation angle from TCS for a long time. For that, the S/N ratio of the ongoing exposure may be worse than usual."
      severityLevels   = [Warning, Major]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = System
      probableCause    = "Network connection with TCS is lost."
      operatorResponse = "Judge if the current observation should continue or be interrupted. Check the status of TCS and the network connection."
      autoAck          = false
      latched          = true
    }

    {
      name             = RETRACT-watchdog
      description      = "The RETRACT functional group is unresponsive"
      severityLevels   = [Major]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = System
      probableCause    = "Software bug"
      operatorResponse = "Restart the assembly and file a bug report."
      autoAck          = false
      latched          = true
    }
    {
      name             = RETRACT-incompatibleStageConfiguration
      description      = "The stage configuration for the retract stage in the Newport XPS motion controller is not compatible with this functional group."
      severityLevels   = [Warning, Major, Critical]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = System
      probableCause    = "Misconfiguration"
      operatorResponse = "Reconfigure the stage configuration in the Newport XPS motion controller and reboot it."
      autoAck          = false
      latched          = false
    }
    {
      name             = RETRACT-inconsistentSensorStatus
      description      = "Sensor status of the retract stage is inconsistent."
      severityLevels   = [Critical]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = BitPattern
      probableCause    = "Cable disconnection, or malfunction of sensors or the hall sensor readout electronics."
      operatorResponse = "Make sure that all relevant cables are connected to the Newport XPS motion controller properly and reboot this Assembly."
      autoAck          = false
      latched          = true
    }
    {
      name             = RETRACT-stepout
      description      = "Stepout of the stepper motor is detected in the retract stage"
      severityLevels   = [Warning, Major, Critical]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = Discrepancy
      probableCause    = "Wear-out of the retract stage mechanism."
      operatorResponse = "Report the issue to the instrument expert."
      autoAck          = false
      latched          = true
    }
    {
      name             = RETRACT-overheat
      description      = "Overheating detected"
      severityLevels   = [Major]
      location         = "IRIS Cold Stop Assembly (IRIS.imager.coldstop)"
      alarmType        = Absolute
      probableCause    = "The cold stop mask was retracted/deployed too many times in a short period."
      operatorResponse = "Monitor the temperature and wait until it is cooled."
      autoAck          = false
      latched          = true
    }
  ]
}