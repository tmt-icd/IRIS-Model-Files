subsystem = IRIS
component = coldstop-assembly

description = """
Commands which can be accepted by IRIS Cold Stop Assembly.

This command model is designed based on [Software Design Patterns for Device and Component Controllers (TMT.INS.TEC.16.079.DRF01)](https://docushare.tmt.org/docushare/dsweb/Get/Document-57492/cc_design_patterns_DRF01_b.docx). As proposed by the design pattern, standard assembly commands and assembly-specific commands are provided for each functional group. All commands are classified into either 'request' or 'submit' based on the command type defintion described in the design pattern document.
"""

receive = [
    {
        name = INIT
        description = """
This command reloads configuration for the cold stop without recycling the power of the motion controller. This command can be invoked only when all stages are stopped.

Command type: request
"""
    }
    {
        name = TEST
        description = """This command executes a self-test.

This command never moves any stage.

__TBD__: Actual action to be taken is TBD.

Command type: request
"""
    }
    {
        name = DATUM
        description = """
This command triggers datuming. It first performs homing of all axes in parallel. After the homing is completed, the linear stage for X axis will move to the specified position (HOME, IN or OUT).

Command type: submit
"""
        requiredArgs = [initialPosition]
        args = [
            {
                name = initialPosition
                description = "initial position of the linaer stage in X axis after homing"
                enum = [HOME, IN, OUT]
                default = HOME
            }
        ]
    }
    {
        name = FOLLOW
        description = """
This command triggers the continuous adjusment of the cold stop based on the events received from TCS. If the cold stop is not inserted to the light path, the cold stop will be first inserted there, and then it starts continuous motion. This continuous motion will last until 'STOP' command is executed, or an unrecoverable error is detected. The description of the events from TCS can be found in [ICD TCS-IRIS (TMT.SEN.ICD.13.002.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Version-63705/ICD_TCS_IRIS_DRF07_20160613_tn_ec_jw.docx).

Command type: request
"""
    }
    {
        name = MOVE
        description = """
This command moves the cold stop stage to the specified position.

Command type: submit
"""
        requiredArgs = [x_pos, y_pos, theta]
        args = [
            {
                name = x_pos
                description = """
X axis absolute position or relative amount from the current positoin (depends on _x_mode_ ).

__TODO__: Define minimum and maximum.
"""
                type = float
                units = mm
                default = 0
            }
            {
                name = x_mode
                description = """
This argument specifies if the given position in _x_pos_ is absolute position or relative amount.
"""
                enum = [ABSOLUTE, RELATIVE]
                default = RELATIVE
            }
            {
                name = y_pos
                description = """
Y axis absolute position or relative amount from the current positoin (depends on _y_mode_ ).

__TODO__: Define minimum and maximum.
"""
                type = float
                units = mm
                default = 0
            }
            {
                name = y_mode
                description = """
This argument specifies if the given position in _y_pos_ is absolute position or relative amount.
"""
                enum = [ABSOLUTE, RELATIVE]
                default = RELATIVE
            }
            {
                name = theta
                description = """
Theta axis absolute angle or relative amount from the current angle (depends on _theta_mode_ ).

__TBD__: Determine the orientation of 0 degree.
"""
                minimum = -180
                maximum = 180
                exclusiveMinimum = true
                exclusiveMaximum = false
                type = float
                units = degree
                default = 0
            }
            {
                name = theta_mode
                description = """
This argument specifies if the given angle in _theta_ is absolute angle or relative amount from the current angle.
"""
                enum = [ABSOLUTE, RELATIVE]
                default = RELATIVE
            }
        ]
    }
    {
        name = LOCK
        description = """
This command locks all the three stages in the cold stop. This command is used in 'Warm Stow' and 'Stow' use cases defined in [IRIS - Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx) to lock mechanisms before pumping or warming the dewer.

__TBD__: Actual action to be taken is TBD. This assembly might retract the cold stop and enable mechanical lock to ensure it won't be moved.

Command type: submit
"""
    }
    {
        name = UNLOCK
        description = """
This command unlocks all the three stages in the cold stop.

This command is used to unlock the stages after cooling or pressurizing is completed. Unlock and index mechanisms should be done in 'Activate' and 'Warm Active' use cases as defined in [IRIS - Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx). To prevent the stages from moving by mistake, this command will not be accepted if the dewer is not in either Activate or Warm Activate stage.

__TBD__: Actual action to be taken is TBD. This may do nothing.

Command type: submit
"""
    }
    {
        name = PARK
        description = """
This command first stops all the stages and moves the linear stage to __TBD__ position. This command is supposed to be called at the end of each night.

__TBD__: Actual action to be taken is __TBD__. Maybe this command just stops all the motion, and do nothing more not to unnecessarily shorten the lifetime of the mechanisms.

Command type: submit
"""
    }
    {
        name = STOP
        description = """
This command stops any on-going command execution or motion.

__TBD__: If this assembly cannot confirm both axes are stopped within expected time (considering configured deceleration), the corresponding state variable becomes 'error'.

Command type: submit
"""
    }
]
