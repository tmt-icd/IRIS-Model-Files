subsystem = IRIS
component = ifs-detector-assembly

description = """
IFS Detector Assembly Commands.

This command model is designed based on [Software Design Patterns for Device and Component Controllers (TMT.INS.TEC.16.079.DRF01)](https://docushare.tmt.org/docushare/dsweb/Get/Document-57492/cc_design_patterns_DRF01_b.docx). As proposed by the design pattern, standard assembly commands and assembly-specific commands are provided for each functional group. All commands are classified into either 'request' or 'submit' based on the command type defintion described in the design pattern document.
"""

receive = [
    {
        name = INIT
        description = """
This command reloads system configuration (e.g. gain, number of read channels) of the detector and the detector controller. This command can be invoked only when there is no on-going exposure.

Command type: request
"""
    }
    {
        name = TEST
        description = """This command executes a self-test.

__TBD__: Actual action to be taken is TBD.

Command type: request
"""
    }
    {
        name = START_EXPOSURE
        description = """
This command starts a new exposure with the given configuration.

Command type: submit
"""
        requiredArgs = [obsId, exposureNumber, rampIntegrationTime]
        args = [
            {
                name = obsId
                description = "Observation ID given by ObserveConfigArg structure as stated in [TMT Software Detailed Design (TMT.SFT.TEC.15.002.REL01)](https://docushare.tmt.org/docushare/dsweb/Get/Document-49912/TMTSoftwareDesign-CSWPD_REL01.pdf)."
                type = string
            }
            {
                name = exposureNumber
                description = """
The exposure # within the observation. This attribute is used to determine the file name written to the disk because there can be multiple exposures in one observation. If multiple exposures are to be taken in one observation, the instrument sequencer will call START_EXPOSURE commands several times with a different exposure #.
"""
                type = integer
                minimum = 0
                maximum = 99999
            }
            {
                name = rampIntegrationTime
                description = "Integration time for one ramp. The specified value will be rounded down to the nearest valid integraiton time so that it will be a multiple of frame readout time. The definition of the integration time is the time between the end of the last reset and the beginning of the last readout. Thus, only one readout will be performed if 0 is specified to this argument."
                type = float
                minimum = 0
                units = ms
            }
            {
                name = ramps
                description = "Number of ramps in one exposure."
                type = integer
                minimum = 1
                default = 1
            }
            {
                name = subregion
                description = """
Subregion definition. the first index specifies either left-bottom-most point or right-top-most point (0 => left-bottom-most, 1 => right-top-most) and the second index specifies x or y (0 => x, 1 => y). The coordinate is 0-based including reference pixel. If this argument is not specified, the whole detector array will be used.

Example: [[x0,y0][x1,y1]] 

__DISCUSSION__: How do we handle reference pixels? Or, do we need to provide a way to specify subregion for scienc exposure?
"""
                type = array
                dimensions = [2,2]
                items = {
                    type = integer
                    minimum = 0
                    maximum = 4095
                }
                units = pixel
            }
        ]
    }
    {
        name = ABORT_EXPOSURE
        description = """
This command aborts the current exposure.

Command type: submit
"""
    }
    {
        name = LOCK
        description = """
This command locks detector from starting detector clocking and taking exposures. This command will be used in Warm Stow use case as mentioned in [IRIS Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx).

__TBD__: Actual action to be taken is TBD.

Command type: submit
"""
    }
    {
        name = UNLOCK
        description = """
This command unlocks detector so that the detector can be powered up. This command will be used in Activate and Warm Activate use cases as mentioned in [IRIS Software Design Document (TMT.INS.PDD.14.024.DRF07)](https://docushare.tmt.org/docushare/dsweb/Get/Document-32613/160210_IRIS_SDD_DRF07.docx).

Command type: submit
"""
    }
    {
        name = DATUM
        description = """
This command turns on power of IFS detector if it is not on, then applies the system configuration (e.g. gain, number of channels) to the detector controller. Timing code may be downloaded to DSP in the detector controller if necessary. This command can be invoked only when there is no on-going exposure.

Command type: submit
"""
    }
    {
        name = PARK
        description = """
This command cancels all on-going exposures and turns off power of IFS detector.

Command type: submit
"""
    }

]
